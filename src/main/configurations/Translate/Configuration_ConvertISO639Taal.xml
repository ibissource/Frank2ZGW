<Module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../FrankConfig.xsd">
    <Adapter name="ConvertISO639Taal"
        active="${ConvertISO639Taal.Active}"
        description="">

        <Receiver name="ConvertISO639Taal">
            <JavaListener name="ConvertISO639Taal" returnedSessionKeys="Error" />
        </Receiver>

        <Pipeline>
            <Exits>
                <Exit name="EXIT" state="SUCCESS"/>
                <Exit name="EXCEPTION" state="ERROR"/>
            </Exits>

            <SenderPipe name="GetISO639CodesFromLocalFSSender">
                <IbisLocalSender
                    name="GetISO639CodesFromLocalFSLocalSender"
                    javaListener="ImportFromLocalFS"
                    returnedSessionKeys="Error">
                    <Param name="FileName" value="${ISO639_Codes_path}"/>                   
                </IbisLocalSender>
                <Forward name="success" path="Alpha2Check"/>
                <Forward name="exception" path="EXCEPTION" />
            </SenderPipe>

            <XmlSwitchPipe
                    name="Alpha2Check" xpathExpression="string-length($Alpha2) > 0 and $Alpha2 != 'null'"
                >
                <Param name="Alpha2" value="" sessionKey="Alpha2"/>
                <Forward name="true" path="GetAlpha3CodeFromAlpha2" />
                <Forward name="false" path="Alpha3Check" />
            </XmlSwitchPipe>
            
            <XmlSwitchPipe name="Alpha3Check"
                           xpathExpression="string-length($Alpha3) > 0 and $Alpha3 != 'null'"
                >
                <Param name="Alpha3" value="" sessionKey="Alpha3" />
                <Forward name="true" path="GetAlpha2CodeFromAlpha3" />
                <Forward name="false" path="EXCEPTION" />
            </XmlSwitchPipe>

            <XsltPipe
                name="GetAlpha3CodeFromAlpha2"
                styleSheetName="Common/xsl/GetISO639Code.xslt"
                >
                <Param name="Alpha2" sessionKey="Alpha2" /> 
                <Forward name="success" path="EXIT" />
            </XsltPipe>

            <XsltPipe
                name="GetAlpha2CodeFromAlpha3"
                styleSheetName="Common/xsl/GetISO639Code.xslt"
                >
                <Param name="Alpha3" sessionKey="Alpha3" />
                <Forward name="success" path="EXIT" />
            </XsltPipe>
        </Pipeline>
    </Adapter>
</Module>
