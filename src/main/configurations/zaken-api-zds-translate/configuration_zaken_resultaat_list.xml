<Module 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../FrankConfig.xsd"
	>
	<Adapter 
		name="resultaat_list"
 		active="${resultaat_list.active}"
		>
		<Receiver name="resultaat_list">
			<ApiListener 
				name="resultaat_list" 
				method="GET"
				uriPattern="/zaken/api/v1/resultaten"
				produces="JSON"
				consumes="ANY"
				/>
		</Receiver>
		<Pipeline>
			<Exits>
				<Exit name="EXIT" state="SUCCESS" code="200"/>
				<Exit name="NotModified" state="SUCCESS" code="304"/>
				<Exit name="BadRequest" state="ERROR" code="400"/>
				<Exit name="NotAuthorized" state="ERROR" code="401" empty="true"/>
				<Exit name="NotAllowed" state="ERROR" code="403" empty="true"/>
				<Exit name="PreconditionFailed" state="ERROR" code="412"/>
				<Exit name="ServerError" state="ERROR" code="500"/>
				<Exit name="Timeout" state="ERROR" code="504"/>
			</Exits>
			
			<XsltPipe
                name="SetRolUrl"
                styleSheetName="Common/xsl/CreateURL.xsl"
                getInputFromFixedValue="&lt;dummy/&gt;"
                storeResultInSessionKey="UrlParam"
                >
                <Param name="BaseUrl" value="${zaakbrug.staging.zaken-api.root-url}" /> 
                <Param name="UrlParam" sessionKey="uri" /> 
                <Forward name="success" path="Create Request"/>
            </XsltPipe>
            
            <XsltPipe
                name="Create Request"
                styleSheetName="Common/xsl/CreateReq.xsl"
                getInputFromFixedValue="&lt;Dummy/&gt;">
                <Param name="dateTime" pattern="{now,date,yyyy-MM-dd'T'HH:mm:ss:SSS}" />
                <Param name="mode" value="resultaat_list" />
                <Param name="Identificatie" sessionKey="zaak" />
                <Forward name="success" path="CallResultaat_TranslationHandler"/>
            </XsltPipe>
            
             <SenderPipe
                name="CallResultaat_TranslationHandler">
                <SoapInputWrapper ></SoapInputWrapper>
                <WsdlXmlInputValidator 
	                wsdl="Common/xsd/Zaak_DocumentServices_1_1_02/zkn0310/zs-dms/zkn0310_beantwoordVraag_zs-dms.wsdl"
	                soapBody="zakLv01"
	                ignoreUndeclaredElements="true"
	                ignoreUnknownNamespaces="true"
	                >
					<Forward name="failure" path="Error"/>
	                <Forward name="parserError" path="Error"/>
				</WsdlXmlInputValidator>
                <IbisLocalSender
                    name="Resultaat_TranslationHandler"
                    javaListener="Resultaat_TranslationHandler">
                    <Param name="ZaakType" sessionKey="zaak" /> 
                    <Param name="url" sessionKey="UrlParam" />
                </IbisLocalSender>
                <Forward name="success" path="XmlTOJson"/>
                <Forward name="exception" path="ServerError" />
            </SenderPipe>
            
            
            
            <FixedResultPipe name="Error"
				returnString="&lt;Error/&gt;" >
				<Forward name="success" path="XmlTOJson"/>
			</FixedResultPipe>
            
            <JsonPipe name="XmlTOJson" direction="XML2JSON">
                <Forward name="success" path="EXIT" />
            </JsonPipe>
		</Pipeline>
	</Adapter>
</Module>