<Module 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="../FrankConfig.xsd"
	>
	<Adapter 
		name="zaakeigenschap_read"
		
		>
		<Receiver name="zaakeigenschap_read">
			<ApiListener 
				name="zaakeigenschap_read" 
				method="GET"
				uriPattern="/zaken/api/v1/zaken/{zaak_uuid}/zaakeigenschappen/{uuid}"
				headerParams="Host"
				produces="JSON"
				consumes="ANY"
				/>
		</Receiver>
		<Pipeline>
			<Exits>
				<Exit name="EXIT" state="SUCCESS" code="200"/>
				<Exit name="NotModified" state="SUCCESS" code="304"/>
				<Exit name="BadRequest" state="ERROR" code="400"/>
				<Exit name="NotAuthorized" state="ERROR" code="401" empty="true"/>
				<Exit name="NotAllowed" state="ERROR" code="403" empty="true"/>
				<Exit name="PreconditionFailed" state="ERROR" code="412"/>
				<Exit name="ServerError" state="ERROR" code="500"/>
				<Exit name="Timeout" state="ERROR" code="504"/>
			</Exits>

			<SenderPipe name="GetUUIDFromDB"
                storeResultInSessionKey="GetIdResult">
                <FixedQuerySender 
                    query="SELECT IDENTIFICATIE FROM ZAAKDETAILS WHERE UUID = ?{uuid}" 
                    queryType="SELECT" 
                    />
                    <Param name="uuid" sessionKey="uuid"/>
	            <Forward name="success" path="CheckForDBResult" />
            </SenderPipe>
            
            <XmlIfPipe name="CheckForDBResult"
                xpathExpression="string-length(result/rowset/row[@number='0']) > 0"
                >
                <Forward name="then" path="Create Request"/>
                <Forward name="else" path="Error"/>
            </XmlIfPipe>
			
			 <XsltPipe
                name="Create Request"
                getInputFromFixedValue="&lt;Dummy/&gt;"
                styleSheetName="Common/xsl/CreateReq.xsl">
                <Param name="dateTime" pattern="{now,date,yyyy-MM-dd'T'HH:mm:ss:SSS}" />
                <Param name="mode" value="eigenschap_list" />
                <Param name="Identificatie" xpathExpression="/result/rowset/row/field" sessionKey="GetIdResult" />
                <Forward name="success" path="CallZaakeigenschap_TranslationHandler"/>
            </XsltPipe>
			
			 <SenderPipe
                name="CallZaakeigenschap_TranslationHandler">
                <!-- <SoapInputValidator soapBody="zakLv01" schemaLocation="http://www.egem.nl/StUF/sector/zkn/0310 GetZaakDetails/xsd/vraagAntwoord/zkn0310_msg_vraagAntwoord.xsd">
                	<Forward name="failure" path="Error" />
				<Forward name="parserError" path="Error" />
                </SoapInputValidator> -->
                <SoapInputWrapper ></SoapInputWrapper>
                <!-- <EsbSoapInputWrapper direction="WRAP" ></EsbSoapInputWrapper> -->
                <WsdlXmlInputValidator 
	                wsdl="Common/xsd/Zaak_DocumentServices_1_1_02/zkn0310/zs-dms/zkn0310_beantwoordVraag_zs-dms.wsdl"
	                soapBody="zakLv01"
	                ignoreUndeclaredElements="true"
	                ignoreUnknownNamespaces="true"
	                >
					<Forward name="failure" path="Error"/>
	                <Forward name="parserError" path="Error"/>
				</WsdlXmlInputValidator>
                <IbisLocalSender
                    name="Zaakeigenschap_TranslationHandler"
                    javaListener="Zaakeigenschap_TranslationHandler">
                    <Param name="Host" xpathExpression="/headers/header[@name = 'Host']/text()" sessionKey="headers"/>
                </IbisLocalSender>
                <Forward name="success" path="XmlTOJson"/>
                <Forward name="exception" path="Error" />
            </SenderPipe>
            
            
           <!--  <XsltPipe
                name="CreateResponse"
                styleSheetName="Common/xsl/CreateResponse.xsl">
                <Forward name="success" path="XmlTOJson"/>
            </XsltPipe> -->
            
            <FixedResultPipe name="Error"
				returnString="&lt;Error/&gt;" >
				<Forward name="success" path="XmlTOJson"/>
			</FixedResultPipe>
            
            <JsonPipe name="XmlTOJson" direction="XML2JSON">
                <Forward name="success" path="EXIT" />
            </JsonPipe>
		</Pipeline>
	</Adapter>
</Module>